<!doctype html>
<html lang="es">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>FERJO - Admin Inventarios</title>
  <link rel="stylesheet" href="styles.css">

  <!-- Google Identity Services -->
  <script src="https://accounts.google.com/gsi/client" async defer></script>
</head>
<body>
  <header>
    <h1>FERJO — Admin Inventarios</h1>

    <!-- Login / Perfil -->
    <div id="authBox">
      <!-- Estado: sin sesión -->
      <div id="signedOut">
        <p style="margin:0 0 8px 0;">Inicia sesión para continuar</p>
        <div id="g_id_onload"
             data-client_id="852782550488-5k5d6gj1fn7q7sbqdn7l532r7pgo5r2t.apps.googleusercontent.com"
             data-context="signin"
             data-callback="onCredentialResponse"
             data-auto_prompt="false">
        </div>
        <div class="g_id_signin" data-type="standard" data-size="large"></div>
      </div>

      <!-- Estado: con sesión -->
      <div id="signedIn" style="display:none">
        <span id="whoami"></span>
        <button id="btnLogout">Salir</button>
      </div>
    </div>

    <!-- Config API -->
    <div class="api-box">
      <label>API URL</label>
      <input id="apiUrl" placeholder="https://script.google.com/macros/s/XXX/exec">
      <button id="saveApi">Guardar</button>
      <span id="apiStatus"></span>
    </div>
  </header>

  <!-- CONTENIDO PROTEGIDO: solo visible si hay sesión válida -->
  <main id="appMain" style="display:none">

    <!-- Tabs visibles según rol -->
    <nav class="tabs">
      <button class="tab active" data-tab="productos"  data-roles="admin,productos">Productos</button>
      <button class="tab"          data-tab="fotos"      data-roles="admin,fotos">Fotos</button>
      <button class="tab"          data-tab="movimientos" data-roles="admin,inventario">Movimientos</button>
    </nav>

    <!-- Panel: Productos -->
    <section id="productos" class="panel active" data-roles="admin,productos">
      <h2>Crear / Actualizar producto</h2>
      <form id="formProducto">
        <div class="grid">
          <label>Id del artículo* <input name="id_del_articulo" required></label>
          <label>Nombre* <input name="nombre" required></label>
          <label>Categoría <input name="categoria"></label>
          <label>Precio de venta* <input name="precio_de_venta" type="number" step="0.01" required></label>
          <label>Cantidad <input name="cantidad" type="number" step="1"></label>
          <label>Moneda <input name="moneda" value="GTQ"></label>
          <label>Estado
            <select name="status">
              <option value="">(auto)</option>
              <option value="activo">activo</option>
              <option value="sin_stock">sin_stock</option>
              <option value="inactivo">inactivo</option>
            </select>
          </label>
          <label>Imagen (URL) <input name="image_url" placeholder="https://..."></label>
          <label>Descripción <textarea name="descripcion" rows="3"></textarea></label>
        </div>
        <div class="actions">
          <button type="submit" id="btnGuardarProducto">Guardar producto</button>
          <button type="button" id="cargarProducto">Cargar por ID</button>
        </div>
        <p class="help">
          Este formulario usa <code>POST /exec?path=product_upsert</code> y
          <code>GET /exec?path=product_fetch</code>.
        </p>
        <pre id="respProducto" class="resp"></pre>
      </form>
    </section>

    <!-- Panel: Fotos -->
    <section id="fotos" class="panel" data-roles="admin,fotos">
      <h2>Cargar fotografía</h2>
      <form id="formFoto" enctype="multipart/form-data">
        <div class="grid">
          <label>Id del artículo* <input name="id_del_articulo" required></label>
          <label>Archivo* <input name="file" type="file" accept="image/*" multiple required></label>
        </div>
        <div class="actions">
          <button type="submit">Subir foto</button>
        </div>
        <p class="help">
          Usa <code>POST /exec?path=upload</code>. Al subir, se sugiere asignar la URL al campo
          <code>image_url</code> del producto (se autollenan <code>image_url</code>, <code>image_url_2</code> o
          <code>image_url_3</code> si están vacíos).
        </p>
        <pre id="respFoto" class="resp"></pre>
      </form>
    </section>

    <!-- Panel: Movimientos -->
    <section id="movimientos" class="panel" data-roles="admin,inventario">
      <h2>Registrar movimiento</h2>
          <form id="formMovimiento">
      <div class="grid">
        <label>Operación*
          <select name="operacion" required>
            <option value="venta">Venta (salida de inventario)</option>
            <option value="compra">Compra (ingreso a inventario)</option>
            <option value="ajuste">Ajuste de stock</option>
          </select>
        </label>

        <label>Id del artículo* <input name="id_del_articulo" required></label>

        <label>Cantidad* <input name="cantidad" type="number" step="1" required></label>

        <label>Precio unitario (venta)
          <input name="precio_unitario" type="number" step="0.01" placeholder="Q 0.00">
        </label>

        <label>Costo unitario (compra)
          <input name="costo_unitario" type="number" step="0.01" placeholder="Q 0.00">
        </label>

        <label>Motivo / referencia
          <input name="motivo" placeholder="Factura, cliente, proveedor, etc.">
        </label>

        <label>Usuario
          <input name="usuario" placeholder="Opcional, se puede dejar el correo">
        </label>

        <label>Observaciones
          <input name="observaciones" placeholder="Notas adicionales">
        </label>
      </div>

      <div class="actions">
        <button type="submit">Registrar</button>
      </div>
      <!-- Info rápida del producto para modo "caja" -->
      <div class="help" id="movProductoInfo" style="margin-top:8px;">
        <!-- Se llenará desde admin.js al buscar el producto -->
      </div>

      <pre id="respMovimiento" class="resp"></pre>
    </form>


      <h3>Generar comprobante (para salidas)</h3>
      <form id="formRecibo">
        <div class="grid">
          <label>ID de movimiento* <input name="id_movimiento" placeholder="MOV-..." required></label>
        </div>
        <div class="actions">
          <button type="submit">Generar PDF</button>
        </div>
        <pre id="respRecibo" class="resp"></pre>
      </form>
    </section>

  </main>

  <footer>
    <p>FERJO Admin — v1.0 • Static (GitHub/Netlify).</p>
  </footer>

  <!-- Config primero, luego auth (controla visibilidad), luego lógica de UI -->
  <script src="config.js"></script>
  <script src="auth.js"></script>
  <script src="admin.js"></script>
</body>
</html>
